<!DOCTYPE html>
<html>
    <header>
        <title>ONNX Runtime JavaScript examples: Quick Start - Web (using script tag)</title>
    </header>
    <body>
        <script type="module">
            // Modified from onnxruntime web examples
            // https://github.com/microsoft/onnxruntime-inference-examples/tree/main/js

            // import onnxruntime web from cdn
            import * as ort from "https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/esm/ort.min.js";
            // set wasm path override
            ort.env.wasm.wasmPaths = "https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/";

            // import numjs from cdn
            import ns from "https://cdn.jsdelivr.net/gh/stdlib-js/ndarray@esm/index.mjs"

            // use an async context to call onnxruntime functions.
            async function main() {
                try {
                    const session = await ort.InferenceSession.create(
                        '../model.onnx',
                        {
                            executionProviders: [
                            //    "webgl", 
                                "wasm"
                            ],
                        },
                    );
                    console.log("Using " + session.ex)

                    // prepare inputs. a tensor need its corresponding TypedArray as data
                    const data = new Float32Array(1*48*100*100);
                    const tensor = new ort.Tensor('float32', data, [1, 48, 100, 100]);
                    const feeds = { "in": tensor };

                    // feed inputs and run
                    const start = new Date();
                    const results = await session.run(feeds);
                    const duration = (new Date()) - start;
                    console.log("fps", 1000 / duration)

                    // read from results
                    const out = await results["out"].getData();
                    document.write(`data of result tensor 'c': ${out}`);
                    console.log(results);

                } catch (e) {
                    document.write(`failed to inference ONNX model: ${e}.`);
                }
            }

            main();
        </script>
    </body>
</html>